<div class="teams-achievements">
    <h4>{{'teamdojoApp.teams.achievements.title' | translate}}</h4>
    <div class="achievements-level-active mockup mb-2" *ngIf="activeAchievement">
        <div class="skill-level-image mx-auto">
            <object class="image" *ngIf="false; else progressPicture"
                    [data]="activeAchievement.picture | imageDataUrl: activeAchievement.pictureContentType">
                {{activeAchievement.name | truncateString}}
            </object>
            <ng-template #progressPicture>
                <div class="ml-auto achievement-progress px-2">
                    <svg viewBox="0 0 32 32">
                        <circle r="16" cx="16" cy="16" style="stroke-dasharray: 40 100;"/>
                    </svg>
                </div>
            </ng-template>
        </div>
    </div>
    <div class="teams-achievements-badges">
        <ngb-accordion activeIds="achievements-badge-0">
            <ngb-panel id="achievements-badge-0">
                <ng-template ngbPanelTitle>
                    <i class="fa fa-caret-right mr-2"></i><span>{{'teamdojoApp.teams.achievements.badges.title' | translate}}</span>
                    <span class="float-right"><span class="mockup minor px-2">0</span>/{{badges.length}}</span>
                </ng-template>
                <ng-template ngbPanelContent>
                    <div class="achievements-badges">
                        <div [ngClass]="{'mb-3': !isLast}" *ngFor="let badge of badges; trackBy: trackId; last as isLast">
                            <a [routerLink]="['.']" [queryParams]="badgeRouteParameters(badge)"
                               (click)="activeAchievement = badge">
                                <div class="d-flex align-items-center achievements-badge"
                                     [ngClass]="{'active': activeAchievement && activeAchievement.id === badge.id}">
                                    <div class="badge-image">
                                        <object class="image" [data]="badge.logo | imageDataUrl: badge.logoContentType">
                                            {{badge.name | truncateString}}
                                        </object>
                                    </div>
                                    <div class="badge-name ml-2">{{badge.name}}</div>
                                    <div class="ml-auto achievement-progress mockup minor px-2">
                                        <svg viewBox="0 0 32 32">
                                            <circle r="16" cx="16" cy="16" style="stroke-dasharray: 40 100;"/>
                                        </svg>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </ng-template>
            </ngb-panel>
        </ngb-accordion>
    </div>
    <div class="mt-1 teams-achievements-dimensions">
        <ngb-accordion [destroyOnHide]="false" activeIds="achievements-dimension-{{activeDimensionId}}">
            <ngb-panel id="achievements-dimension-{{dimension.id}}"
                       *ngFor="let dimension of team.participations; trackBy: trackId">
                <ng-template ngbPanelTitle>
                    <div class="d-flex align-items-center achievements-dimension"
                         [routerLink]="['.']" [queryParams]="{'dimension': dimension.id}">
                        <div class="d-flex align-items-center">
                            <i class="fa fa-caret-right mr-2"></i>
                            <div class="d-inline-block mockup minor px-2">
                                <div class="skill-level-image">
                                    <object class="image" [data]="'' | imageDataUrl: ''">
                                        {{'Current skill level' | truncateString}}
                                    </object>
                                </div>
                            </div>
                            <span>{{dimension.name}}</span>
                        </div>
                        <div class="ml-auto">
                            <span class="mockup minor px-2">0</span>/{{(levels[dimension.id] || []).length}}
                        </div>
                    </div>
                </ng-template>
                <ng-template ngbPanelContent>
                    <div class="achievements-skill-levels">
                        <div [ngClass]="{'pb-3': !isLast}" id="achievements-level-{{level.id}}"
                             *ngFor="let level of levels[dimension.id]; trackBy: trackId; last as isLast">
                            <a [routerLink]="['.']"  [queryParams]="levelRouteParameters(dimension, level)"
                               (click)="activeAchievement = level">
                                <div class="d-flex align-items-center achievements-skill-level"
                                     [ngClass]="{'active': activeAchievement && activeAchievement.id === level.id}">
                                    <div class="skill-level-image">
                                        <object class="image" [data]="level.picture | imageDataUrl: level.pictureContentType">
                                            {{level.name | truncateString}}
                                        </object>
                                    </div>
                                    <div class="skill-level-name ml-2">{{level.name}}</div>
                                    <div class="ml-auto achievement-progress mockup minor px-2">
                                        <svg viewBox="0 0 32 32">
                                            <circle r="16" cx="16" cy="16" style="stroke-dasharray: 12 100;"/>
                                        </svg>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </ng-template>
            </ngb-panel>
        </ngb-accordion>
    </div>
</div>
